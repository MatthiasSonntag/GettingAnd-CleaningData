---
title: "README"
author: "Matthias Sonntag"
date: "26.07.2015"
output: html_document
---



# Preface

The README (i) lists the files in the repositry and states how they are connected with each other. Furthermore it (ii) explains how the R-file, run_analysis.R, creates a new dataset called Average from the original data of an experiment conducted by Anguita et al. in 2012 in which smartphones were used to recognize certain human activities. The dataset is called "Human Activity Recognition Using Smartphones Data Set" $^1$ and can be downloaded via this url: 
<http://archive.ics.uci.edu/ml/machine-learning-databases/00240/UCI%20HAR%20Dataset.zip> 


# Repository Contents and file connections 
The repo containes the following files:

+ README.md: informs about the R-file, run_analysis.R, and the connections of the files in the repo
+ CodeBook.md: codebook for the Average dataset stored in Average.txt
+ run_analysis.R: a R-file which generates the Average dataset

CodeBook.md provides all necessary information regarding the original data, a high level description of how the Average dataset is generated by run_analysis.R from the original data and a detailed description of every variable of the Average dataset. 

The R-file reads in and processes the original data. Subsequently only data on the mean and standard deviation is extracted from the merged original data. The resulting dataset is processed further and used to create a new dataset called Average, which is written to an equally named text-file. CodeBook.md-file provides the respective information on the Average dataset

#run_analysis.R
## Input dataset
Download the original dataset ("Human Activity Recognition Using Smartphones Data Set") via the given url. Unzipping the file (UCI HAR Dataset.zip) into the R-working-directory leads to a folder called "UCI HAR Dataset" which contains the data-files.
The following eight files are needed and given with their paths in the UCI-HAR-Dataset-folder, where "~/" refers to the working directory.

```r
1. ~/UCI HAR Dataset/test/X_test.txt
2. ~/UCI HAR Dataset/train/X_train.txt
3. ~/UCI HAR Dataset/features.txt
4. ~/UCI HAR Dataset/test/subject_test.txt
5. ~/UCI HAR Dataset/train/subject_train.txt
6. ~/UCI HAR Dataset/test/y_test.txt
7. ~/UCI HAR Dataset/train/y_train.tx
8. ~/UCI HAR Dataset/activity_labels.txt
```
File one to seven contains the data. File eight the activity labels, see below and CodeBook.md

##Output dataset
The output of the script is written to a txt-file in the working directory. The path is

```r
"~/Average.txt"
```

##Code description
* Merge data to new dataset
* Extract only measurements of the mean and the standard deviation of the measurements
* Use desriptive names to decribe the activies in the respective column
* Give the column names descriptive variable names
* Create a new datset with the average of each variable for each activity and each subject

###Merging a single dataset from first seven input files.
The goal of the merging is to get a single dataset with a subject column, an activity column and the measurement columns, in this order. Since all the data (columns) is divided in training and test data. The merging of the dataset comprises of several steps. 

1. Use read.table() to read in the test and the training data and concatenate them via rbind() to get the databody. Note that the training data comes first.

```r
x.test <- read.table("~/UCI HAR Dataset/test/X_test.txt")
x.train <- read.table("~/UCI HAR Dataset/train/X_train.txt")
databody <- rbind(x.train,x.test)
```
2. Use read.table() to read in the features data and assign the second column containing the names of the measurements to the databody.

```r
features <- read.table("~/UCI HAR Dataset/features.txt",
                       stringsAsFactors=F, col.names=c("number","originalNames"))
names(data.body) <- features$originalNames
```
The numerical data.body has 581 columns with the measurements. Now two columns, the subjects and the activities they have performed in the experiment, need to be added to the databody. Before that can be done the respective training and test data must be merged.

3. Use read.table() to read in the subject data diveded in training and test data again and construct a subject-vector.

```r
sub.test <- read.table("~/UCI HAR Dataset/test/subject_test.txt")
sub.train <- read.table("~/UCI HAR Dataset/train/subject_train.txt")
subject <- rbind(sub.train,sub.test)
```
4. Use read.table() to read in the activity data diveded in training and test data again and construct an activity-vector. Note the activities are coded as numbers.

```r
activity.test <- read.table("~/datasciencecoursera/UCI HAR Dataset/test/y_test.txt")
activity.train <- read.table("~/datasciencecoursera/UCI HAR Dataset/train/y_train.txt")
activity <- rbind(activity.train,activity.test)
```
Having all parts necessary the singe dataset can be build.

5. Use data.frame to paste the subject-vector, the activity-vector and the databody columns together, thus obtaining the single dataset, called whole.data.

```r
whole.data <- data.frame(subject,activity,databody)
```
Note the column names of the subject is now V1 and of the activities V1.1 respectively.

###Extract only measurements of the mean and the standard deviation of the measurements
Firstly get the column names of the dataset whole.data. 
Use the function grepl() in combination with the function which() on the column names to get the indices of the columns to extract. Note that the columns with the subjects and the activities need to be kept too, therefore three which-grepl-statements are necessary, one for the Vs, one for the means and the third for the std. Having the column indices, subset whole.data with them. The resulting smaller dataset is called meadSdData.

```r
#get column names
ColumnNames <- colnames(whole.data)
#extract mean and std columns and preserve the subject and activity column
col.indices <- c( which(grepl("V1"  ,ColumnNames)==T),
                  which(grepl("mean",ColumnNames)==T),
                  which(grepl("std", ColumnNames)==T))
#get desired data by subsetting the respective columns determined before
meanSdData <- whole.data[,col.indices]
```

###Use descriptive names to describe the activities in the respective column
Use read.table() to read in the table which assigns the activity labels/numbers to the actual activity names. Providing the column names makes the subsequent use easier.The resulting dataset is called activity.labels.

```r
activity.labels <- read.table("~/datasciencecoursera/UCI HAR Dataset/activity_labels.txt",stringsAsFactors=F, col.names=c("number","action"))
```
Store the number of different activities in the variable dal by using dim() on the activity.labels. The first entry of the variable dal corresponds to the number of different activities. This is important to automate the for-loop which is used to replace the activity numbers with the respective names.

```r
dal <- dim(activity.labels)
```
The operation of the for-loop is best explained with i=1. If i=1 the loop is not only executed for the first time, but 1 is also the number which codes for the first activitiy. As this is the case it can be used to find all the rows where the activity is coded as number 1 (Note that the activity numbers are of class integer. To work properly with the logical equal sign the index i of the loop needs to be converted to class character.) and simultaneously to get the respective activity name from the dataset activity.labels in which the activity numbers and names are stored.

```r
#rename activities using a loop from 1 to number of columns of activity.labels
for (i in 1:dal[1]){
      #if the activity is 1 then the second coluumn of the 1. row of 
      #activity.labels is assigned to it,which is the decriptive activity name. 
      #This happens for each number fom 1 up to 6.
      meanSdData[meanSdData$V1.1==as.character(i),2]<-activity.labels[i,2] 
}
```
### Give the column names descriptive variable names
The next step is to provide meaningful column names, so one can easily understand the meaning of the column variables. Again one needs to extract the column names first using colnames(). The old column names are stored in the vector meanSdDataColumns. Now one can firstly rename the subject and activity columns. This is achieved by simply assigning a character vector with the respective names to the colnames of the dataset meanSdData. One needs to be careful to use only the old names stored in meanmeanSdDataColumns from the third to the last entry. Otherwise there were to many names, since we want to change the first two column names and the columns would be labeled incorrectly.

```r
meanSdDataColumns <- colnames(meanSdData)
colnames(meanSdData) <- c("Subject","Activity",
                           meanSdDataColumns[3:length(meanSdDataColumns)])
```
After renaming the first two columns one can proceed to alter the column names, which I preferred to store temporarily in the character-vector newColnames. To change the column names the function gsub() takes as first argument the string which should be searched and as second argument the replacement. The exchanges can easily be seen in the code. After all changes have been applied the newColnames assigned to our meanSdData dataset. From which we can compute the new dataset Average in the next step.


```r
newColnames <- gsub("BodyBody","Body",colnames(meanSdData),fixed=T)
newColnames <- gsub(".","",newColnames,fixed=T)
newColnames <- gsub("tBody","TimeDomain.Body",newColnames,fixed=T)
newColnames <- gsub("tGravity","TimeDomain.Gravity",newColnames,fixed=T)
newColnames <- gsub("fBody","FrequencyDomain.Body",newColnames,fixed=T)
newColnames <- gsub("Mag","Magnitude",newColnames,fixed=T)
newColnames <- gsub("Acc","Acceleration",newColnames,fixed=T)
newColnames <- gsub("Gyro","AngularVelocity",newColnames,fixed=T)
newColnames <- gsub("std","StandardDeviation",newColnames,fixed=T)
newColnames <- gsub("mean","Mean",newColnames,fixed=T)
newColnames <- gsub("X",".X.Direction",newColnames,fixed=T)
newColnames <- gsub("Y",".Y.Direction",newColnames,fixed=T)
newColnames <- gsub("Z",".Z.Direction",newColnames,fixed=T)
newColnames <- gsub("MeanFreq","Mean.Frequency",newColnames,fixed=T)
colnames(meanSdData) <- newColnames
```

### Create a new dataset with the average of each variable for each activity and each subject
I use the library data.table since it is fast and commands can be kept short. meanSdDats class is then changed to data.table. To make fast use of data.table the key is set to the variables / column names by which the average should be calculated. The lapply-function in combination with .SD,mean calculates the mean for every column except the columns by which the calculation is grouped, which is provided in the by-statement. Finally the Average dataset is written to the equally named text-file.

```r
library(data.table)
# change from class data.frame to data.table
meanSdData <- data.table(meanSdData)
# setkey for fast use of data.table
setkey(meanSdData,Subject,Activity)
# create new tidy dataset Average
Average <- meanSdData[,lapply(.SD,mean),by=list(Subject,Activity)]
#write dataset without row names to txt-file
write.table(Average,"~/Average.txt",row.names=F)
```

# Sources
$^1$: Davide Anguita, Alessandro Ghio, Luca Oneto, Xavier Parra and Jorge L. Reyes-Ortiz. A Public Domain Dataset for Human Activity Recognition Using Smartphones. 21th European Symposium on Artificial Neural Networks, Computational Intelligence and Machine Learning, ESANN 2013. Bruges, Belgium 24-26 April 2013. 
